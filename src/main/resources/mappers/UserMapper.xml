<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.projrentalprac.user.UserMapper">
    <insert id="insUser" useGeneratedKeys="true"  keyProperty="iuser">
        INSERT INTO t_user
        SET iaddr = #{iaddr}
        , rest_addr = #{restAddr}
        , uid = #{uid}
        , upw = #{upw}
        , nick = #{nick}
        <if test=" pic != null and pic != '' ">
            , stored_pic = #{pic}
            , request_pic = #{pic}
        </if>
        , phone = #{phone}
        , email = #{email}
        , y = #{y}
        , x = #{x}
    </insert>

    <select id="selUser">
        SELECT iuser, iauth
        FROM t_user
        WHERE uid = #{uid} and iuser = #{iuser}
    </select>

    <select id="findUid">
        SELECT uid
        FROM t_user
        WHERE phone = #{phone}
    </select>

    <select id="findUidCheck">
        SELECT COUNT(uid) FROM t_user WHERE phone = #{phone}
    </select>

    <update id="findUpw">
        UPDATE t_user
        SET upw = #{newUpw}
        WHERE uid = #{uid}
        and phone = #{phone}
    </update>

    <update id="updInfo">
        UPDATE t_user
        <set>
        <if test=" nick != null and nick != '' ">
            nick = #{nick},
        </if>
        <if test=" pic != null and pic != '' ">
            request_pic = #{pic},
            stored_pic = #{pic},
        </if>
        <if test=" upw != null and upw != '' ">
            upw = #{upw},
        </if>
        <if test=" phone != null and phone != '' ">
            phone = #{phone},
        </if>
        <if test=" restAddr != null and restAddr != '' ">
            rest_addr = #{restAddr},
        </if>
        <if test=" email != null and email != '' ">
            email = #{email}
        </if>
        </set>
        WHERE iuser = #{iuser}
    </update>
</mapper>